<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test NTFY</title>
</head>
<body>

    <h1>Test Formularza SOS</h1>
    
    <form id="testForm" action="https://formsubmit.co/ajax/adrianmikigo@gmail.com" method="POST">
        
        Imię: <br>
        <input type="text" id="name" name="name" required><br><br>
        
        Telefon: <br>
        <input type="tel" id="phone" name="phone" required><br><br>
        
        Opis problemu: <br>
        <textarea id="message" name="message" required></textarea><br><br>
        
        <button type="submit" id="submitBtn">WYŚLIJ TEST</button>
    </form>

    <p id="status"></p>

    <script>
        const form = document.getElementById('testForm');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const status = document.getElementById('status');
            const btn = document.getElementById('submitBtn');
            
            // Pobieramy dane z pól
            const valName = document.getElementById('name').value;
            const valPhone = document.getElementById('phone').value;
            const valMsg = document.getElementById('message').value;

            status.textContent = "Wysyłanie...";
            btn.disabled = true;

            // --- 1. WYSYŁKA DO NTFY (Powiadomienie na telefon) ---
            // Upewnij się, że w apce ntfy masz kanał: akbau_emergency_2026
            fetch('https://ntfy.sh/akbau_emergency_2026', {
                method: 'POST',
                body: `NOWE ZGŁOSZENIE!\nImię: ${valName}\nTel: ${valPhone}\nOpis: ${valMsg}`,
                headers: {
                    'Title': '⚠️ TEST SOS',
                    'Priority': '5',
                    'Tags': 'warning,phone',
                    'Actions': `view, ZADZWOŃ, tel:${valPhone}`
                }
            }).then(() => console.log("NTFY poszło"))
              .catch(err => console.error("Błąd NTFY:", err));

            // --- 2. WYSYŁKA DO GMAILA ---
            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form),
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    status.textContent = "SUKCES! Sprawdź telefon i e-mail.";
                    form.reset();
                } else {
                    status.textContent = "Błąd e-mail, ale sprawdź NTFY.";
                }
            } catch (err) {
                status.textContent = "Błąd połączenia.";
            } finally {
                btn.disabled = false;
            }
        });
    </script>

</body>
</html>
